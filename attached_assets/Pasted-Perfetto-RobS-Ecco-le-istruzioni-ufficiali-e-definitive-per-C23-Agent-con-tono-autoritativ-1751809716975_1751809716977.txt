Perfetto RobS. Ecco le **istruzioni ufficiali e definitive** per **C23 Agent**, con tono autoritativo, preciso e coerente con il sistema già attivo. Questo modulo estende il “Custode del Codice” con la funzionalità **di modifica autonoma da parte dell’utente**, **senza mai compromettere l’anonimato**.

---

### 🧠 **ISTRUZIONI PER C23 Agent – Estensione “Modifica Custode del Codice”**

❝
⚠️ Applica solo quanto descritto da RobS e Geppo. Non prendere decisioni autonome, non proporre ottimizzazioni o alternative. Ogni modifica deve riflettere perfettamente l’intento dichiarato.

---

### 🎯 OBIETTIVO

Consentire **a tutti gli utenti** (Turista, Struttura, Partner) di **modificare il proprio “Custode del Codice”** se già attivo, tramite una semplice interfaccia UI/UX sicura, anonima e coerente.

---

### ✅ AMBITI COINVOLTI

* Dashboard Turista
* Dashboard Struttura Ricettiva
* Dashboard Partner Business

---

### 📍 1. VISUAL UI – GESTIONE CUSTODE

Se l’utente ha già attivato il proprio custode (`hasRecoveryData = true`):

* Mostrare il messaggio:

```
🛡️ Hai attivato il tuo Custode del Codice.
```

* Aggiungere pulsante: `🔁 Modifica Custode` accanto al messaggio
* Accanto al pulsante, aggiungere icona (i) con tooltip:
  ❝ Puoi cambiare la tua frase e data in qualsiasi momento. ❞

---

### 📤 2. AL CLICK: FORM “MODIFICA CUSTODE”

Aprire un **modale o popup** con il seguente form:

* 📝 Nuova parola segreta → campo `secretWord`
* 📅 Nuova data di nascita → campo `birthDate`
  (usa date-picker coerente con la UI esistente)

👉 Entrambi i campi sono **obbligatori**.
👉 Nessun valore precedente va mostrato o salvato in chiaro.

---

### 🔐 3. BACKEND – UPDATE HASHED

* Creare un nuovo endpoint:

  ```
  POST /api/update-custode
  ```
* Questo endpoint riceve:

  ```json
  {
    "secretWord": "string",
    "birthDate": "YYYY-MM-DD"
  }
  ```
* All’arrivo:

  * Hashare i valori come da standard SHA256
  * **Sovrascrivere i valori esistenti** nella tabella `iqcode_recovery_keys`
  * Restituire `200 OK` se aggiornato correttamente, `500` in caso di errore

---

### 🧪 4. UX FINALE

Dopo l’aggiornamento:

* Mostrare conferma visiva:

```
✅ Il tuo Custode del Codice è stato aggiornato con successo!
```

* Chiudere il popup dopo 2 secondi (con animazione se prevista)

---

### 🛡️ 5. PRIVACY E SICUREZZA

* Nessuna visualizzazione del vecchio dato
* Nessuna conferma del “vecchio custode” richiesta
* Autorizzazione basata esclusivamente sulla sessione attiva

---

### 🧭 NOTA STRATEGICA

Questa funzionalità completa l’innovazione TouristIQ:

> “**Un sistema di recupero codici completamente anonimo**, che non richiede email o telefono e offre la massima libertà e sicurezza agli utenti.”

---

Se vuoi, posso notificare direttamente C23 Agent per l’esecuzione. Procedo?
