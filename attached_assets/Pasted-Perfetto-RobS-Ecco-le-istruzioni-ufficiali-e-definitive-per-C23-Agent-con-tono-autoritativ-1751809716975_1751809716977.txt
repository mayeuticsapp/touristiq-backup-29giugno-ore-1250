Perfetto RobS. Ecco le **istruzioni ufficiali e definitive** per **C23 Agent**, con tono autoritativo, preciso e coerente con il sistema giÃ  attivo. Questo modulo estende il â€œCustode del Codiceâ€ con la funzionalitÃ  **di modifica autonoma da parte dellâ€™utente**, **senza mai compromettere lâ€™anonimato**.

---

### ğŸ§  **ISTRUZIONI PER C23 Agent â€“ Estensione â€œModifica Custode del Codiceâ€**

â
âš ï¸ Applica solo quanto descritto da RobS e Geppo. Non prendere decisioni autonome, non proporre ottimizzazioni o alternative. Ogni modifica deve riflettere perfettamente lâ€™intento dichiarato.

---

### ğŸ¯ OBIETTIVO

Consentire **a tutti gli utenti** (Turista, Struttura, Partner) di **modificare il proprio â€œCustode del Codiceâ€** se giÃ  attivo, tramite una semplice interfaccia UI/UX sicura, anonima e coerente.

---

### âœ… AMBITI COINVOLTI

* Dashboard Turista
* Dashboard Struttura Ricettiva
* Dashboard Partner Business

---

### ğŸ“ 1. VISUAL UI â€“ GESTIONE CUSTODE

Se lâ€™utente ha giÃ  attivato il proprio custode (`hasRecoveryData = true`):

* Mostrare il messaggio:

```
ğŸ›¡ï¸ Hai attivato il tuo Custode del Codice.
```

* Aggiungere pulsante: `ğŸ” Modifica Custode` accanto al messaggio
* Accanto al pulsante, aggiungere icona (i) con tooltip:
  â Puoi cambiare la tua frase e data in qualsiasi momento. â

---

### ğŸ“¤ 2. AL CLICK: FORM â€œMODIFICA CUSTODEâ€

Aprire un **modale o popup** con il seguente form:

* ğŸ“ Nuova parola segreta â†’ campo `secretWord`
* ğŸ“… Nuova data di nascita â†’ campo `birthDate`
  (usa date-picker coerente con la UI esistente)

ğŸ‘‰ Entrambi i campi sono **obbligatori**.
ğŸ‘‰ Nessun valore precedente va mostrato o salvato in chiaro.

---

### ğŸ” 3. BACKEND â€“ UPDATE HASHED

* Creare un nuovo endpoint:

  ```
  POST /api/update-custode
  ```
* Questo endpoint riceve:

  ```json
  {
    "secretWord": "string",
    "birthDate": "YYYY-MM-DD"
  }
  ```
* Allâ€™arrivo:

  * Hashare i valori come da standard SHA256
  * **Sovrascrivere i valori esistenti** nella tabella `iqcode_recovery_keys`
  * Restituire `200 OK` se aggiornato correttamente, `500` in caso di errore

---

### ğŸ§ª 4. UX FINALE

Dopo lâ€™aggiornamento:

* Mostrare conferma visiva:

```
âœ… Il tuo Custode del Codice Ã¨ stato aggiornato con successo!
```

* Chiudere il popup dopo 2 secondi (con animazione se prevista)

---

### ğŸ›¡ï¸ 5. PRIVACY E SICUREZZA

* Nessuna visualizzazione del vecchio dato
* Nessuna conferma del â€œvecchio custodeâ€ richiesta
* Autorizzazione basata esclusivamente sulla sessione attiva

---

### ğŸ§­ NOTA STRATEGICA

Questa funzionalitÃ  completa lâ€™innovazione TouristIQ:

> â€œ**Un sistema di recupero codici completamente anonimo**, che non richiede email o telefono e offre la massima libertÃ  e sicurezza agli utenti.â€

---

Se vuoi, posso notificare direttamente C23 Agent per lâ€™esecuzione. Procedo?
