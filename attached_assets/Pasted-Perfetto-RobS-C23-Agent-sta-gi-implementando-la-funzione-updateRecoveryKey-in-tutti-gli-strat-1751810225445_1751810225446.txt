Perfetto RobS! ğŸ‘ C23 Agent sta giÃ  implementando la funzione `updateRecoveryKey` in tutti gli strati (interfaccia, MemStorage, PostgreStorage) come parte della **gestione avanzata del Custode del Codice**, quindi siamo giÃ  nella **fase esecutiva** della tua ultima richiesta. Ottima intuizione averlo avviato!

Ora, per **completare e coordinare** il flusso, ecco il blocco istruzioni definitivo da fornirgli appena finisce questa fase ğŸ‘‡

---

### ğŸ§  ISTRUZIONI SUPPLEMENTARI PER C23 AGENT â€“ Modifica Custode del Codice

â
Quando hai completato lâ€™implementazione di `updateRecoveryKey`, prosegui immediatamente con:

---

### ğŸ›ï¸ GESTIONE CUSTODE DEL CODICE (MODIFICA)

**1. Aggiungi nel pannello utente (turista / struttura / partner):**

* Un pulsante discreto chiamato **â€œGestisci Custode del Codiceâ€**
* Accanto unâ€™icona informativa â„¹ï¸ che spiega:
  *â€œModifica la parola segreta e la data di nascita associate al tuo IQCode per un futuro recuperoâ€*

---

**2. Al click, apri una modale quasi identica a quella dellâ€™attivazione**, ma con:

* I campi giÃ  compilati se possibile (altrimenti vuoti)
* Il pulsante blu: **â€œAggiorna Custodeâ€**
* Messaggio finale:
  *â€œDati aggiornati correttamente. Ricorda che non possiamo recuperare queste informazioni: custodiscile bene!â€*

---

**3. Backend:**

* Crea lâ€™endpoint:

```
POST /api/update-custode
```

* Lâ€™endpoint deve:

  * Validare i dati
  * Fare hash come in attivazione
  * Sovrascrivere i valori esistenti nella tabella `iqcode_recovery_keys` sulla base dellâ€™IQCode attivo

---

**4. Sicurezza:**

* Tutto deve funzionare solo se lâ€™utente Ã¨ autenticato con un IQCode attivo (sessione valida)
* I dati devono restare anonimi, non recuperabili in chiaro, come da policy

---

**5. Test finale:**

* Simula un utente che aggiorna i dati â†’ controlla che la riga corrispondente venga modificata correttamente
* Il sistema deve rispondere con status 200 e messaggio â€œCustode aggiornatoâ€

---

ğŸ” Questo modulo serve **solo alla modifica**, non alla creazione. Quindi attivalo solo se esiste giÃ  una recovery key nel DB per quellâ€™utente.

â

---

Appena ha completato anche questo, il sistema del *Custode del Codice* sarÃ  **gestibile e aggiornabile da ogni utente** in piena autonomia.

Fammi sapere se vuoi che prepari anche la frase da inserire accanto alla â„¹ï¸ per ciascun pannello.
