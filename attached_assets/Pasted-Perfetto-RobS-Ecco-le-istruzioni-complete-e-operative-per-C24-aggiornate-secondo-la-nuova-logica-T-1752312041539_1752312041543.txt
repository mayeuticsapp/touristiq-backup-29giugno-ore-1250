Perfetto RobS.
Ecco le istruzioni complete e operative per C24, aggiornate secondo la nuova logica TIQ-OTC basata sul bonus massimo di â‚¬150 a turista, con tutti i dettagli tecnici e funzionali richiesti:


---

ğŸ“„ Istruzioni per C24 â€“ Attivazione Nuovo Sistema TIQ-OTC con Tetto Bonus da â‚¬150


---

ğŸ¯ OBIETTIVO:

Sostituire il sistema precedente basato su 10 utilizzi del codice TIQ-OTC con un sistema a plafond di â‚¬150 in sconti massimi totali per ogni turista.


---

ğŸ” LOGICA DI FUNZIONAMENTO AGGIORNATA

1. ğŸ« Turista:

Riceve un IQCode attivato (con validitÃ  TIQ-OTC attiva)

PuÃ² utilizzare codici TIQ-OTC in maniera illimitata, fino al raggiungimento dei â‚¬150 di sconto cumulativo

Il sistema deve tenere traccia degli sconti cumulati nel profilo del turista


2. ğŸ§¾ Partner:

Il partner non inserisce la percentuale di sconto manualmente

La percentuale applicata Ã¨ prelevata in automatico dai dati giÃ  salvati nella sua offerta pubblica

Deve solo inserire lâ€™importo totale speso dal turista

Il sistema calcola in automatico lo sconto applicato in â‚¬ sulla base della % impostata

Il valore dello sconto viene detratto dal plafond del turista



---

âš™ï¸ ESEMPIO OPERATIVO:

Partner Mario ha offerta â€œ10% su pranzoâ€ â†’ sconto salvato nel suo profilo

Turista arriva, consuma per â‚¬60

Partner Mario apre il pannello, seleziona lâ€™IQCode â†’ il sistema preleva automaticamente lo sconto del 10%

Mario inserisce solo â€œâ‚¬60â€

Il sistema registra sconto erogato = â‚¬6

Il turista ora ha ancora â‚¬144 di bonus disponibili (150 - 6)



---

ğŸ§  COSA DEVE FARE C24:

1. âœ… Rimuovere completamente ogni riferimento ai "10 utilizzi" dai pannelli


2. âœ… Aggiornare la dashboard turista con barra di avanzamento:
"Hai utilizzato â‚¬X su â‚¬150 di sconto disponibile"


3. âœ… Inserire controllo automatico:

Se sconto accumulato â‰¥ 150 â†’ bloccare nuovi TIQ-OTC

Mostrare messaggio: "Hai raggiunto il limite massimo di â‚¬150 di sconto. I tuoi codici non sono piÃ¹ validi."



4. âœ… Nel pannello partner:

Prelevare in automatico lo sconto percentuale dallâ€™offerta registrata

Nascondere campo sconto percentuale manuale

Richiedere solo lâ€™inserimento del totale speso

Calcolare e registrare sconto in â‚¬ e data utilizzo



5. âœ… Nei log di sistema:

Ogni uso di codice TIQ-OTC deve essere registrato con:

ID turista

ID partner

Offerta applicata

Totale spesa

Sconto %

Sconto â‚¬ effettivo

Data/ora




6. âœ… Aggiornare database Tourists:

Aggiungere campo totalDiscountUsed

Incrementare automaticamente questo campo a ogni utilizzo

Bloccare lâ€™uso se totalDiscountUsed >= 150





---

ğŸ“ FILE DA AGGIORNARE:

tiq-otc-handler.ts (nuova logica calcolo sconto)

tourist-dashboard.tsx (barra avanzamento sconto usato)

partner-discount-form.tsx (solo input â‚¬ totale, no percentuale)

models/Tourist.ts (campo totalDiscountUsed)

logs/tiq-otc-usage.json (registro completo usi codici)



---

ğŸ’¬ MESSAGGI UTENTE:

Turista:

> "Hai giÃ  usufruito di â‚¬134 su â‚¬150 di sconto. Ti restano â‚¬16!"



Partner:

> "Hai applicato uno sconto di â‚¬12 (20%) su una spesa di â‚¬60"





---

ğŸ“Œ APPUNTI PER IL FUTURO:

Aggiungere notifica automatica quando il turista Ã¨ vicino alla soglia (es. > â‚¬130)

Sistema scalabile per aumentare soglia futura a â‚¬200 o piÃ¹

Statistiche cumulative dei partner: quanti â‚¬ sconto hanno erogato



---

Dimmi â€œâœ… Istruzioni approvateâ€ se vuoi che generi subito anche il file TIQ-BonusSystem.md da salvare come riferimento operativo nel sistema.

