Grazie per lo screen aggiornato RobS, ora è **tutto chiaro al 100%**:
il problema è **confermato nel backend** → **`getTouristAvailableUses()` restituisce 0 codici disponibili**, nonostante il database li contenga.

---

### ✅ **ECCO IL PROBLEMA:**

Dallo screen si vede:

```ts
🟠 getTouristAvailableUses (iqCode: IQ-IT-3101-TORRE) → disponibilità: 0 codici
```

Ma tu hai **appena attivato** l’IQCode definitivo → i **10 codici TIQ-OTC dovevano essere creati** al momento della sua attivazione.

---

### 🎯 AZIONE IMMEDIATA DA FARE (C24 deve seguire questa checklist):

#### 1. **Controlla la funzione `generateIQCodeDefinitivo()` o simile**

✔️ Dopo aver creato l’IQCode definitivo (`IQ-IT-3101-TORRE`), **deve essere chiamata anche**:

```ts
await storage.initializeOneTimeCodesForTourist(touristId, 10);
```

Se non c’è questo passaggio → **i codici non vengono creati**.

---

#### 2. **Controlla se `initializeOneTimeCodesForTourist()`** esiste davvero

✔️ Verificare che il metodo **crei effettivamente 10 righe nel DB** per quel turista, con valori tipo:

```json
{ code: '89413', status: 'attivo', touristId: 3101 }
```

---

#### 3. **Controlla che il `touristId` sia passato correttamente**

✔️ A volte viene passato `undefined` o un ID errato. Loggare **il `tourist.id`** dopo il login e in fase di attivazione IQCode.

---

#### 4. **Se il metodo viene eseguito, aggiungi un log nel backend tipo:**

```ts
console.log("🎯 Inizializzati 10 codici TIQ-OTC per il turista", touristId);
```

Per verificare **a runtime** che l'inserimento sia realmente avvenuto.

---

### 🛠️ In alternativa (debug immediato):

Chiedi a C24 di **eseguire questa query manuale nel DB**, per vedere se i codici sono mai stati creati:

```sql
SELECT * FROM one_time_codes WHERE tourist_id = (SELECT id FROM tourists WHERE iqcode = 'IQ-IT-3101-TORRE');
```

Se restituisce 0 righe → significa che **l’inizializzazione dei 10 codici non è MAI avvenuta.**

---

### ✅ CONCLUSIONE

C24 deve:

* [ ] Inserire il blocco di inizializzazione dei codici al momento dell’attivazione IQCode
* [ ] Confermare che vengono effettivamente scritti nel database
* [ ] Far sì che l’endpoint `/api/tourist/one-time-codes` li legga correttamente

Il frontend è già pronto: appena il backend risponde con i codici, tutto si aggiorna.

Appena mi confermi che C24 ha corretto, facciamo il test finale con un nuovo utente e chiudiamo definitivamente questa parte.
