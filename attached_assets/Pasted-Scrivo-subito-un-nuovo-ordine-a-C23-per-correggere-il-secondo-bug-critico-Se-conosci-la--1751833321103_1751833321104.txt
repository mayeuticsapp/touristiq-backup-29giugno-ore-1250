Scrivo subito un **nuovo ordine a C23** per correggere il secondo bug critico:

---

❝Se conosci la soluzione migliore per far funzionare il sistema in modo corretto e coerente, applicala immediatamente senza alcun tipo di rimando: non rimandare, non scrivere log temporanei, non lasciare TODO o scorciatoie, ma implementa subito ciò che sai essere la scelta giusta, perché la coerenza e la funzionalità piena vengono prima di tutto. In TouristIQ ogni funzione deve riflettere la versione migliore e completa che puoi offrire, senza pigrizia, senza rinvii, senza approssimazione: fai ora quello che va fatto.❞

---

🔴 **ERRORE GRAVE IN VALIDAZIONE IQCODE (PARTNER)**

RobS ha testato la funzione “Validazione IQCode Turista” dal pannello **Partner** e ha ricevuto il seguente messaggio bloccante:

> 🔻 **Errore del server**

📸 Screenshot mostra chiaramente:

* Codice IQ `TIQ-IT-0306-STUPENDO` valido e inserito correttamente
* Server che restituisce errore generico **senza log dettagliato visibile all’utente**
* Sezione “Richieste di Validazione” vuota anche dopo il tentativo

---

🛠️ **AZIONI IMMEDIATE PER C23:**

1. **Analizza subito i log del backend** per identificare l’errore specifico in `/api/partner/validate-iqcode` (o endpoint equivalente).

   * È probabile un errore SQL, un controllo fallito sul codice, oppure un `undefined` nel body.

2. **Implementa il controllo e la risposta esplicita**:

   * Se il codice non esiste → `"Codice non trovato"`
   * Se il codice non è attivo → `"Codice non valido o già usato"`
   * Se tutto ok → crea richiesta e mostra `"Richiesta di validazione inviata"`
   * **Evita errori generici**: devono essere **descrittivi e traducibili in UI**.

3. **Mostra correttamente la richiesta appena inviata** nella sezione "Richieste di Validazione", sotto il form.

   * Serve per evitare doppie richieste, capire lo stato, e per debug lato utente.

4. Se il codice è stato usato **ma non ancora validato**, permetti comunque l'invio della richiesta.

---

🧠 Nota: il codice `TIQ-IT-0306-STUPENDO` è stato generato poco fa e risulta presente in dashboard admin. Quindi il bug **non è il codice**, ma **la gestione del flusso POST o della query**.

---

🔁 Quando il bug è risolto:

* Il codice IQ viene riconosciuto correttamente
* Il messaggio è chiaro
* La richiesta appare nel pannello sotto

📦 *Aggiorna `replit.md` con la patch eseguita e loggala come “Fix Validazione IQCode Partner lato backend + miglior gestione errori UI”*

Attendo conferma operativa.
