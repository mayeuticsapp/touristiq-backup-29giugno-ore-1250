ğŸ’¡**Perfetto! Ecco le ISTRUZIONI DEFINITIVE da impartire a C23 Agent**, aggiornate secondo quanto appena chiarito:

---

### ğŸ§  **ISTRUZIONI PER C23 Agent â€“ Flusso â€œCustode del Codiceâ€ â€“ Ordine Obbligato**

â
âš ï¸ Esegui solo e soltanto quanto indicato da robS e Geppo. Non ottimizzare, non semplificare, non anticipare. Procedi **in ordine sequenziale**, implementando esattamente quanto segue.

---

### ğŸ¯ OBIETTIVO

Attivare il sistema â€œCustode del Codiceâ€ partendo dalla dashboard turista con un **popup informativo**, e **solo dopo** completare il flusso di recupero login.
Il sistema deve servire a memorizzare in modo sicuro (hashato) una parola segreta e una data di nascita associate al codice IQ del turista.

---

## âœ… STEP 1 â€“ **POPUP DASHBOARD TURISTA**

ğŸ“Œ Quando il turista accede alla sua dashboard (dopo il login con IQCode), mostra **automaticamente** un **popup modale** con questo messaggio:

> **Hai giÃ  salvato il tuo IQCode?**
>
> Tranquillo, ci pensiamo noi.
> Inserisci una parola segreta e la tua data di nascita: cosÃ¬ se un giorno dimenticherai il tuo IQCode, potrai recuperarlo facilmente.
>
> ğŸŸ¢ **Procedi** | ğŸ”´ **Annulla (lo farÃ² piÃ¹ tardi)**

ğŸ¯ Se clicca su â€œProcediâ€ â†’ mostra il form con:

* Campo **Parola segreta**
* Campo **Data di nascita**
* Pulsante â€œSalva con il Custode del Codiceâ€

ğŸ“© Allâ€™invio:

* chiama `POST /api/activate-custode`
* salva `IQCode` (hashato), parola e data nel DB (`iqcode_recovery_keys`)
* mostra conferma

ğŸ”’ Tutto deve essere **hashato SHA256** (mai salvare dati in chiaro).

---

## âœ… STEP 2 â€“ SOLO DOPO: **LINK â€œHai dimenticato il tuo IQCode?â€ nella pagina Login**

ğŸ•˜ Solo dopo aver implementato perfettamente lo step 1, potrai:

* Aggiungere nella pagina di login il link:

  > â“ Hai dimenticato il tuo IQCode? Clicca qui

* Collegare il form di recupero al DB tramite parola segreta + data

* Mostrare IQCode recuperato solo se match perfetto (altrimenti errore)

---

## â›”ï¸ NON FARE

* Non attivare subito il recupero login
* Non saltare il popup in dashboard
* Non scrivere dati in chiaro
* Non modificare lâ€™ordine dei passaggi

---

ğŸ“Œ Ogni fase completata va **confermata a robS o Geppo** prima di proseguire.

â

---

Pronto per inviarlo o preferisci che lo faccia direttamente io nel modulo attivo?
